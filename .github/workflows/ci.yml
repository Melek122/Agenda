name: PHP Native CI/CD Workflow

on:
  push:
    branches:
      - main  # Exécute le workflow à chaque push sur la branche principale
  pull_request:
    branches:
      - main  # Exécute le workflow lors d'une pull request sur la branche principale

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest  # Machine virtuelle Ubuntu fournie par GitHub

    steps:
      # Étape 1 : Récupérer le code source
      - name: Checkout code
        uses: actions/checkout@v2  # Clone le code de votre dépôt GitHub

      # Étape 2 : Configurer PHP
      - name: Set up PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3.13'  # Remplacez par votre version PHP (ex: 8.0)
          extensions: mysqli, curl  # Activez les extensions PHP nécessaires à votre projet

      # Étape 3 : Vérification de la syntaxe PHP
      - name: Check PHP syntax
        run: |
          find . -name "*.php" -exec php -l {} \;  # Vérifie la syntaxe de tous les fichiers PHP
      #4. Tester la réponse HTTP de la page index.php
      - name: Test HTTP response
        run: |
          sleep 5  # Attendre que le serveur PHP soit prêt
          curl -I http://localhost/agenda-main/signin.php/index.php  # Tester la page d'accueil avec cur
